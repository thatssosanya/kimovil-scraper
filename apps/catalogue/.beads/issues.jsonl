{"id":"click-or-die-catalogue-stage-1","title":"Add JSON ratings endpoint for WordPress","description":"","notes":"WordPress site needs structured rating data for SSR in Blade templates. Current /api/wordpress/get-widget returns HTML for HTMX, but View Composers need JSON.\n\n## Implementation\nCreate `/api/wordpress/get-rating-data.ts` endpoint\n\n## API Contract\n- GET request only\n- Params: ratingId OR groupId (required), type (rating|group), baseUrl (optional)\n- Returns JSON with rating metadata + devices array (rank, name, price, links, etc)\n- 5 min cache (in-memory + HTTP headers)\n- CORS enabled\n- Full TypeScript interfaces provided\n\n## Features\n- Fetch by ratingId or groupId\n- Device links with marketplace data\n- Page URLs with selectedRating param\n- Comprehensive error handling\n- Response guarantees: devices sorted by rank, all ranks sequential\n\n## Related\n- WordPress: click-or-die.ru-23 (View Composer)\n- WordPress: click-or-die.ru-30 (Replace static ratings)\n\n## Progress\n✅ Created src/pages/api/wordpress/get-rating-data.ts (370 lines)\n- All TypeScript interfaces implemented\n- CORS headers configured\n- 5-min caching with TTL cleanup\n- fetchRatingData() for rating queries\n- fetchGroupData() for group queries\n- Comprehensive error handling (400/404/405/500)\n\nReady for deployment testing.\nFull spec and code in handoff doc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T19:41:57.150202+02:00","updated_at":"2025-12-17T02:11:08.814743+01:00","closed_at":"2025-12-17T02:11:08.814743+01:00"}
{"id":"click-or-die-catalogue-stage-1rq","title":"Update UI to support database duplicate attributes","description":"Support the new duplicate detection fields (normalizedName, duplicateStatus, duplicateOfId) in the device UI. Show duplicate status, link to original device, allow managing duplicates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T03:17:15.52981+01:00","updated_at":"2025-12-17T18:01:01.239245+01:00","closed_at":"2025-12-17T18:01:01.239245+01:00"}
{"id":"click-or-die-catalogue-stage-3em","title":"Fix build error: Cannot find module for page /dashboard","description":"Next.js build fails at static page generation with: [Error [PageNotFoundError]: Cannot find module for page: /dashboard]. This happens after successful TypeScript compilation. Likely a routing or file structure issue in the pages directory.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T02:10:28.871153+01:00","updated_at":"2025-12-17T18:05:21.243392+01:00","closed_at":"2025-12-17T18:05:21.243392+01:00"}
{"id":"click-or-die-catalogue-stage-4jx","title":"Design generalized toast notification system","description":"Current toast system has several issues that need a more robust solution:\n\n1. **Array iteration bug**: Object.entries(array) gives indices ('0', '1') as keys, not actual IDs - easy to make this mistake\n2. **Visibility suppression timing**: Need to register visibility BEFORE component that shows info mounts, not in the component itself\n3. **State staleness**: React hook values captured at render time become stale in effects - must use store.getState() inside effects for current values\n4. **Initial load suppression**: On page navigation, existing states shouldn't trigger toasts - need to track 'initial load' separately\n\nConsider a more declarative approach where:\n- Components declare what notifications they're 'claiming' via context/store\n- Toast system checks claims before showing\n- Claims are registered synchronously, not in useEffect\n- Maybe a useToastSuppression(deviceId) hook that handles registration properly","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T02:48:42.962704+01:00","updated_at":"2025-12-17T02:48:42.962704+01:00"}
{"id":"click-or-die-catalogue-stage-8d6","title":"Better spinner/loading states in ImportSpecs UI","description":"Current loading states feel basic. Need more polished spinner and loading animations across the scraping workflow states.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T03:17:10.209713+01:00","updated_at":"2025-12-17T03:17:10.209713+01:00"}
{"id":"click-or-die-catalogue-stage-cb0","title":"Clean up dashboard ratings page design","description":"Modernize ratings dashboard to match devices page patterns: use native header with actions bar, improve rating card design","notes":"## Progress\n\n✅ Header refactored to use native `useHeaderActions` pattern\n- Filters (type, category, status) in header left actions\n- Search, preview/save, create in header right actions\n- Removed custom DashboardRatingsHeader component\n\n✅ Rating cards polished\n- Modern `rounded-xl` cards with subtle shadows\n- Better spacing and visual hierarchy\n- Dark mode support\n- Hover states for action buttons\n- Cleaner metadata layout\n\nReady for review.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T22:46:33.545901+01:00","updated_at":"2025-12-17T22:59:28.382056+01:00"}
{"id":"click-or-die-catalogue-stage-cmp","title":"Restructure components: public/dashboard/shared separation","description":"Reorganize src/components/ to clearly separate public-facing, dashboard, and shared components.","notes":"## COMPLETED\n\nComponent restructuring finished. New structure:\n\\`\\`\\`\nsrc/components/\n├── dashboard/       # Admin dashboard components\n│   ├── layout/      # Layout, Sidebar, Header\n│   ├── device/      # DeviceTable, DeviceProfile, dialogs, hooks\n│   ├── rating/      # components, dialogs, hooks, ratings-page\n│   ├── link/        # Link management\n│   ├── scraping/    # useScraper, useJobStatus hooks\n│   ├── widgets/     # Dashboard widgets\n│   └── common/      # FilterBar, CatalogueTable\n├── public/          # Public-facing components\n│   ├── layout/      # SiteHeader\n│   ├── device/      # DevicePage, BrandSection\n│   └── rating/      # RatingGroup, DeviceCard\n├── shared/          # Used by both (Logo, DeviceImage, RatingBadge)\n└── ui/              # shadcn primitives\n\\`\\`\\`\n\n### Naming Changes\n- CatalogueHeader → SiteHeader\n- DeviceProfile (public) → DevicePage\n- DeviceProfileV2 (dashboard) → DeviceProfile\n\n### Deleted\n- src/components/features/ (all files)\n- src/components/Catalogue/ (all files)\n","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-17T19:30:00+01:00","updated_at":"2025-12-17T21:00:00+01:00","closed_at":"2025-12-17T21:00:00+01:00"}
{"id":"click-or-die-catalogue-stage-czf","title":"Upgrade to Next.js 16","description":"## Summary\nUpgrade from Next.js 15.3.3 to Next.js 16.x\n\n## Breaking Changes to Address\n1. **Turbopack default** - We have custom webpack config, need to use --webpack flag or migrate config\n2. **middleware.ts → proxy.ts** - Rename middleware file\n3. **Node.js 20.9+ required** - Verify Node version\n4. **next lint removed** - Update package.json scripts to use ESLint directly\n5. **Test build and functionality**\n\n## Current Versions\n- Next.js: 15.3.3\n- Target: 16.x (latest: 16.0.10)\n\n## Resources\n- Migration guide: https://nextjs.org/docs/app/guides/upgrading/version-16\n- Codemod: npx @next/codemod@canary upgrade latest","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T18:24:08.42088+01:00","updated_at":"2025-12-17T18:24:20.170145+01:00"}
{"id":"click-or-die-catalogue-stage-dvw","title":"Replace DeviceView dialog with link to full DeviceProfile page","description":"DeviceView is a compact device editor shown in a dialog from the ratings page. Consider replacing it with a simple link to /dashboard/devices/[id] instead of maintaining two editors.","notes":"## Current State\n\n- `DeviceView` lives at `features/device/views/index.tsx`\n- Used via `DeviceViewDialog` in `RatingDeviceList` (ratings dashboard)\n- Path: `/dashboard/ratings` → select rating → click device → dialog opens\n\n## Why It's Almost Legacy\n\n- We have `DeviceProfileV2` (soon `DeviceProfile`) as the full-page editor\n- Maintaining two device editors is redundant\n- DeviceView shares components with profile-v2 (DeviceSpecifications, ImportSpecs)\n\n## Options\n\n1. **Replace dialog with link** - Click device in rating list → opens `/dashboard/devices/[id]` in new tab\n2. **Keep dialog but simplify** - Show read-only preview, link to full editor\n3. **Merge into one** - Use DeviceProfile in a modal/drawer\n\n## Components to Keep\n\nThese from `views/components/` are reused and should stay:\n- `DeviceSpecifications/` - used by profile-v2\n- `ImportSpecs` - used by profile-v2\n- `ProsConsAdapter` - used by public DevicePage\n- `types/DeviceWithConfigs` - used in 5+ places\n\n## Action Items\n\n- [ ] Decide on replacement approach\n- [ ] Update RatingDeviceList to link instead of dialog\n- [ ] Move shared components to proper location\n- [ ] Delete DeviceView and DeviceViewDialog","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T20:00:00+01:00","updated_at":"2025-12-17T20:00:00+01:00"}
{"id":"click-or-die-catalogue-stage-oat","title":"Create DeviceButton component","description":"Create a reusable DeviceButton/DeviceLink component for consistent device navigation across the app.\n\nShould be used in:\n- SlugConflictPanel (duplicate detection UI)\n- Device tables/lists\n- Any place that links to a device page\n\nFeatures:\n- Takes deviceId and optional deviceName\n- Primary color styling (text-primary)\n- Arrow indicator (→)\n- Hover state\n- Consistent font-semibold styling\n- Could support different sizes (sm, md)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T03:02:29.269789+01:00","updated_at":"2025-12-17T03:02:29.269789+01:00"}
{"id":"click-or-die-catalogue-stage-yk0","title":"Fix Clerk/React 19 compatibility warnings","description":"## Root Cause\n\nThe warning \"Attempted import error: 'useContext' is not exported from 'react'\" occurs because @clerk/nextjs 6.x's \\`clerkMiddleware\\` imports from \\`next/navigation\\` (App Router API) even when using Pages Router. This import chain:\n\n\\`\\`\\`\n@clerk/nextjs/server → clerkMiddleware.js → next/navigation → useContext\n\\`\\`\\`\n\n...fails to resolve properly with React 19.1.0 + Next.js 15.3.3.\n\n## Investigation Summary\n\n1. **The warning is harmless** - Build completes successfully, app functions correctly\n2. **Cannot be fixed via webpack aliasing** - \\`clerkMiddleware\\` itself (not just \\`auth\\`) imports App Router code\n3. **This is a Clerk SDK issue** - They claim Pages Router compatibility but internally use App Router imports\n4. **No alternative** - \\`authMiddleware\\` was deprecated in v5, \\`clerkMiddleware\\` is the only option\n\n## Recommendation\n\n- **Accept the warning** - It doesn't affect functionality\n- **Monitor Clerk releases** - Check @clerk/nextjs 7.x canary or future versions for a fix\n- **Alternative**: Downgrade to React 18 if warning is unacceptable (not recommended)\n\n## Versions Tested\n- @clerk/nextjs: 6.21.0\n- React: 19.1.0\n- Next.js: 15.3.3","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T02:12:30.385998+01:00","updated_at":"2025-12-17T18:20:40.754333+01:00","closed_at":"2025-12-17T18:20:40.754333+01:00"}
